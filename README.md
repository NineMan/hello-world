# hello-world

Hello Guys! 
It'my repository


====================================================
Документация компонентов обновления справочника ФИАС
====================================================

Структура проекта
-----------------
- source/fias/ - Django проект с настройками
- source/updates_producer/ - Django приложение для получения и упаковки обновлений в пакеты и отправки в очередь
- source/updates_installer/ - Django приложение для обслуживания (установки) очереди обновлений
- source/manage.py - скрипт командной строки для управления приложением (--help для полного набора команд)
- documentation - Sphinx документация Python модулей

Системные требования
--------------------

* Как минимум 80 ГБ места на диске на момент первоначальной выгрузки справочника и от 3 ГБ для работы скрипта обновления
* Для боевой среды также:
   - Виртуальное окружение с Python 3.7 версией и зависимостями, указанными в requirements.txt
* Для среды разработки:
   - Docker и docker-compose (протестировано на 19.03.13 движке и 1.27.4 compose)
   - Sphinx (проверено на 3.3.1 версии) вне контейнера для документирования кода
   - black (проверено на 20.8b1) для форматирования кода

Вспомогательные команды для разработки:
---------------------------------------
.. code-block:: console

   # Форматирование кода инструментом black (не забывать про ручной перенос строк)
   python -m black --line-length 79 source/

   # Обновление документации
   sphinx-apidoc --output-dir documentation/ --no-toc --module-first --implicit-namespaces <ПУТЬ_ДО_ОБНОВЛËННОГО_МОДУЛЯ> **/migrations/


Описание переменных окружения:
---------------------------------------
###### DJANGO_SETTINGS_MODULE
указатель пути для management/commands где искать настройки Django
Значение `fias.settings`

BROKER_URL=amqp://guest:guest@0.0.0.0:5672/fias-virtual-host

###### QUERIES_LIMIT
ограничение одновременного количества задач
значение по умолчанию (не более 10 задач в секунду) = `10/s`

###### PACKAGE_SIZE
размер пакетов загрузки в БД, целое число
Значение по умолчанию = `500`

###### DOWNLOAD_LINK
Url службы поставки обновлений ФИАС.
Запрос по этому адресу возвращает информацию о всех версиях файлов,
доступных для скачивания. Значение:
`https://fias.nalog.ru/WebServices/Public/GetAllDownloadFileInfo`

###### DOWNLOAD_DIR
Директория для временного хранения архива обновления
и распакованных XML таблиц. Должна быть создана в директории проекта
Без конечного слеша. Значение по умолчанию - `tmp`

Запуск проекта:
---------------------------------------

0. Убедиться, что выполняются [системные требования](#Системные требования)

1. `git clone https://gitlab.newcontact.su/fias_auto_updater/auto_updater.git`

2. Переходим в проект: `cd auto_updater`

3. Запускаем докер-композ: `docker-compose up`

4. Переходим в приложение: `cd source/`

5. Загружаем схему БД: `python manage.py install_schema`

6. Запускаем приложение: `python manage.py getupdates`

